<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ロビー</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
.feature-box {
  margin-top: 10px;
}

.feature-title {
  margin-top: 14px;
  margin-bottom: 6px;
  font-weight: bold;
  font-size: 15px;
  border-left: 4px solid #888;
  padding-left: 8px;
}

.feature-list {
  list-style: none;   /* ← ◯を消す */
  padding-left: 0;
  margin: 0 0 8px 0;
}

.feature-list li {
  padding: 2px 0;
}


/* ===== ルーム別カラー ===== */
.room.room1 {
  background: #ffdddd;
}

.room.room2 {
  background: #dde8ff;
}

.room.denki {
  background: #fff4cc;
}

.room.special {
  background: #ffddee;
}

.room-title {
  font-weight: bold;
  margin-bottom: 4px;
}
.room-info {
  font-size: 14px;
  margin-bottom: 6px;
}
button {
  padding: 6px 12px;
  margin-right: 5px;
}
input[type="password"] {
  padding: 5px;
  width: 120px;
}
</style>
</head>
<body>

<h2>ロビー</h2>

<div id="features" style="
  border:1px solid #ccc;
  padding:12px;
  margin-bottom:20px;
  background:#f9f9f9;
">
 <h3 style="margin-top:0;">機能</h3>

<div class="feature-box">

  <div class="feature-title">部屋紹介</div>
  <ul class="feature-list">
    <li>ルーム1通常部屋</li>
    <li>ルーム2通常部屋</li>
    <li>【完成】電気椅子部屋（2人対戦・観戦可）</li>
    <li>スペシャルルーム（身内用）</li>
    <li>個室使用不可</li>
  </ul>

  <div class="feature-title">機能説明</div>
  <ul class="feature-list">
    <li>女子罰 / 男子罰 / 苦痛罰（スペシャルのみ）</li>
    <li>ダイス機能（例：1d6+1）</li>
    <li>内緒機能</li>
  </ul>

  <div class="feature-title">アップデート</div>
  <ul class="feature-list">
    <li>内緒機能復活</li>
  </ul>

</div>

  </ul>
</div>

<div id="error" style="color:red; margin-bottom:10px;"></div>

<div class="room room1">
  <div class="room-title">ルーム1</div>
  <div class="room-info">
    人数（<span id="count-room1">0</span>人）
    <span id="names-room1">なし</span>
  </div>
  <button onclick="enterRoom('room1')">入室</button>
</div>

<div class="room room2">
  <div class="room-title">ルーム2</div>
  <div class="room-info">
    人数（<span id="count-room2">0</span>人）
    <span id="names-room2">なし</span>
  </div>
  <button onclick="enterRoom('room2')">入室</button>
</div>

<div class="room denki">
  <div class="room-title">電気椅子</div>
  <div class="room-info">
    人数（<span id="count-denki">0</span>人）
    <span id="names-denki">なし</span>
  </div>
  <button onclick="enterRoom('denki')">入室</button>
</div>

<div class="room special">
  <div class="room-title">スペシャル</div>
  <div class="room-info">
    人数（<span id="count-special">0</span>人）
    <span id="names-special">なし</span>
  </div>
  <button onclick="enterRoom('special')">入室</button>
</div>

<div class="room">
  <div class="room-title">個室A</div>
  <div class="room-info">
    人数（<span id="count-privateA">0</span>人）
    <span id="names-privateA">なし</span>
  </div>
  <input type="password" id="key-privateA" placeholder="鍵">
  <button onclick="enterRoom('privateA')">入室</button>
</div>

<div class="room">
  <div class="room-title">個室B</div>
  <div class="room-info">
    人数（<span id="count-privateB">0</span>人）
    <span id="names-privateB">なし</span>
  </div>
  <input type="password" id="key-privateB" placeholder="鍵">
  <button onclick="enterRoom('privateB')">入室</button>
</div>

<div class="room">
  <div class="room-title">個室C</div>
  <div class="room-info">
    人数（<span id="count-privateC">0</span>人）
    <span id="names-privateC">なし</span>
  </div>
  <input type="password" id="key-privateC" placeholder="鍵">
  <button onclick="enterRoom('privateC')">入室</button>
</div>

<div class="room">
  <div class="room-title">個室D</div>
  <div class="room-info">
    人数（<span id="count-privateD">0</span>人）
    <span id="names-privateD">なし</span>
  </div>
  <input type="password" id="key-privateD" placeholder="鍵">
  <button onclick="enterRoom('privateD')">入室</button>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();

socket.on("lobbyUpdate", rooms => {
  const allRooms = [
    "room1",
    "room2",
    "denki",
    "special",
    "privateA",
    "privateB",
    "privateC",
    "privateD"
  ];

  allRooms.forEach(room => {
    const countEl = document.getElementById(`count-${room}`);
    const namesEl = document.getElementById(`names-${room}`);
    const btn = document.querySelector(`button[onclick="enterRoom('${room}')"]`);
    if (!countEl || !namesEl || !btn) return;

    const info = rooms[room];
    if (info) {
      countEl.textContent = info.count;
      namesEl.textContent = info.names.join(", ");
      if (room.startsWith("private") && info.count >= 2) {
        btn.disabled = true;
        btn.textContent = "満室";
      } else {
        btn.disabled = false;
        btn.textContent = "入室";
      }
    } else {
      countEl.textContent = 0;
      namesEl.textContent = "なし";
      btn.disabled = false;
      btn.textContent = "入室";
    }
  });
});

function enterRoom(room) {
  const errorEl = document.getElementById("error");
  errorEl.textContent = "";

  let key = "";
  if (room.startsWith("private")) {
    key = document.getElementById(`key-${room}`)?.value || "";
  }

  socket.emit("checkRoomKey", { room, key });

  socket.off("checkResult");
  socket.on("checkResult", res => {
    if (!res.ok) {
      errorEl.textContent = res.message || "入室できません";
      return;
    }
    localStorage.setItem("chatRoom", room);
    localStorage.setItem("chatKey", key);
    location.href = "/";
  });
}
</script>

</body>
</html>
